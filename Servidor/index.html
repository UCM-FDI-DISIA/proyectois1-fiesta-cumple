<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veneris</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="profile-styles.css">
    <link rel="stylesheet" href="cuatroEnRaya.css">
    <link rel="stylesheet" href="dosVerdades.css">
    <!-- Script temprano: evita que la pantalla de login parpadee si hay sesión guardada -->
    <script>
        try {
            var _saved = null;
            try { _saved = sessionStorage.getItem('chat_currentUserId'); } catch(e) { _saved = null; }
            // NOTA: no se usa localStorage aquí para evitar compartir la sesión entre pestañas.
            if (_saved) {
                // Marcar el documento como en proceso de restauración para ocultar el login antes de pintar
                document.documentElement.classList.add('session-restoring');
            }
        } catch (e) {
            /* No crítico si falla */
        }
    </script>
</head>
<body>
    <!-- BARRA DE NAVEGACIÓN -->
    <div id="nav-bar" class="nav-bar" style="display:none;">
        <h1 class="nav-title">Veneris</h1>
        <div class="nav-buttons">
            <button onclick="toggleUserList()" class="nav-button">Descubre gente</button>
            <button onclick="toggleChatInterface()" class="nav-button">Chat</button>
        </div>
    </div>

    <!-- PANTALLA DE LOGIN SIMPLIFICADA -->
    <div id="login-screen" style="display:block;">
        <div class="login-container">
            <!-- Columna izquierda: contenido -->
            <div class="login-content">
                <div class="login-logo" id="veneris-logo">
                    <img src="https://i.ibb.co/mrVRvty7/poieaienv-eojewofiho3287429834729eifjwpofji.png" alt="Veneris Logo">
                </div>
                <h1 class="login-title" id="main-title">Conecta con quien vibra como tú.</h1>
                <h2 class="login-subtitle">Amor, juego y mitología.</h2>
                <button class="login-cta-btn" onclick="showRegisterForm()">Explorar Veneris</button>
                <p class="login-tagline" id="tagline">Inspirado en Venus. Diseñado para almas que buscan algo más.</p>
            </div>
            
            <!-- Columna derecha: formulario -->
            <div class="login-form-section">
                <h3>Iniciar sesión / Registrarse</h3>
                <p id="login-subtitle">Inicia sesión con tu email y contraseña</p>
                <input type="email" id="login-email" placeholder="Tu email/nombre de usuario">
                <input type="password" id="login-password" placeholder="Tu contraseña">
                <button onclick="login()" class="login-btn-primary">Iniciar Sesión</button>
                <button onclick="showRegisterForm()" class="login-btn-secondary">Crear Cuenta Nueva</button>
                <p id="login-error" style="color:red;"></p>
            </div>
        </div>
    </div>

    <!-- PANTALLA DE REGISTRO CON ENCUESTA -->
    <div id="register-screen" style="display:none;">
        <h1>Crear tu Perfil</h1>
        <p>Completa tu perfil para empezar a chatear</p>
        <div class="register-form">
            <h3>Datos de acceso</h3>
            <input type="email" id="register-email" placeholder="Tu email" required>
            <input type="password" id="register-password" placeholder="Tu contraseña (mínimo 6 caracteres)" required>
            <input type="text" id="register-name" placeholder="Tu nombre de usuario (debe ser único)" required>

            <h3>Fotos de perfil (obligatorias)</h3>
            <div class="photo-upload-container">
                <label for="profile-photo">Foto principal:</label>
                <input type="file" id="profile-photo" accept="image/*">
                <div id="photo-preview" class="photo-preview"></div>
            </div>
            <div class="photo-upload-container">
                <label for="profile-photo-2">Segunda foto:</label>
                <input type="file" id="profile-photo-2" accept="image/*">
                <div id="photo-preview-2" class="photo-preview"></div>
            </div>

            <h3>Hábitos</h3>
            <label><input type="checkbox" name="habit" value="Deportista"> Deportista</label>
            <label><input type="checkbox" name="habit" value="Lector"> Lector</label>
            <label><input type="checkbox" name="habit" value="Viajero"> Viajero</label>
            <label><input type="checkbox" name="habit" value="Cocinero"> Cocinero</label>
            <label><input type="checkbox" name="habit" value="Músico"> Músico</label>
            <label><input type="checkbox" name="habit" value="Gamer"> Gamer</label>

            <h3>Gustos e intereses</h3>
            <div id="preference-options" class="preference-options">
                <label><input type="radio" name="preference" value="hombre"> Hombre</label>
                <label><input type="radio" name="preference" value="mujer"> Mujer</label>
                <label><input type="radio" name="preference" value="ambos" checked> Ambos</label>
            </div>

            <div class="form-group">
                <h3>Género</h3>
                <div class="radio-group">
                    <label><input type="radio" name="genero" value="hombre" required> Hombre</label>
                    <label><input type="radio" name="genero" value="mujer" required> Mujer</label>
                </div>
            </div>

            <h3>Información adicional</h3>
            <input type="number" id="age" placeholder="Tu edad" min="18" max="100">
            <input type="number" id="altura" placeholder="Tu altura (cm)" min="54" max="272" step="1">
            <input type="number" id="peso" placeholder="Tu peso (kg)" min="1" max="737" step="1">

            <button onclick="completeRegistration()" class="btn-primary">Crear Cuenta</button>
            <button onclick="showLoginForm()" class="btn-secondary">Volver al Login</button>
            <p id="register-error" style="color:red;"></p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL DEL CHAT -->
    <div id="chat-screen" style="display:none;">
        <!-- BARRA LATERAL DE CHATS -->
        <div id="chat-sidebar" class="chat-sidebar">
            <div class="sidebar-header">
                <h3>Mis Chats</h3>
            </div>
            <div id="chat-list" class="chat-list">
                <div id="no-chats-message" class="no-chats-message">
                    No hay chats registrados
                </div>
            </div>
            <div class="sidebar-footer">
                <!-- Botón '+ Añadir chat' eliminado por petición del usuario -->
            </div>
        </div>

        <!-- VENTANA DE MENSAJES -->
        <div id="chat-window" class="chat-window">
            <div id="header">
                <div class="chat-header-user">
                    <div id="chat-avatar" class="chat-avatar"></div>
                    <h2 id="chat-title">Chat en Vivo</h2>
                </div>
                <div id="couple-points-widget" class="couple-points-widget" style="display:none;">
                    <div class="points-icon">💕</div>
                    <div class="points-info">
                        <div class="points-label">Tus puntos</div>
                        <div class="points-value" id="couple-points-value">0</div>
                    </div>

                    <div id="partner-info-dropdown" class="partner-info-dropdown" style="display:none;">
                        <div class="partner-info-item">
                            <span class="partner-info-label">Altura:</span>
                            <span class="partner-info-value" id="partner-altura-value">-</span>
                        </div>
                        <div class="partner-info-item">
                            <span class="partner-info-label">Peso:</span>
                            <span class="partner-info-value" id="partner-peso-value">-</span>
                        </div>
                        <div class="partner-info-item">
                            <span class="partner-info-label">Foto: </span>
                            <span class="partner-info-value" id="partner-foto-value">-</span>
                        </div>
                    </div>
                </div>

                <div id="user-info"></div>
            </div>

            <!-- ÁREA DE MENSAJES -->
            <div id="messages" class="messages-container">
                <div>Elije a alguien para hablar</div>
            </div>

            <!-- CONTENEDOR DEL JUEGO (SE MUESTRA/OCULTA DINÁMICAMENTE) -->
            <div id="game-container" style="display:none;">
                <div id="game-board-wrapper">
                    <div class="game-status">
                        <div id="current-player-game">Esperando...</div>
                        <div id="game-message-container"></div>
                    </div>
                    <div id="game-board-online"></div>
                    <div class="game-controls-footer">
                        <button id="close-game-online-btn" class="game-btn-inline close-btn">✖ Cerrar juego</button>
                    </div>
                </div>
            </div>

            <!-- ÁREA DE ENTRADA DE MENSAJES -->
            <div id="input-area">
                <div class="games-menu-container">
                    <button id="open-games-menu-btn" title="Juegos" disabled>🎮</button>
                    <div id="games-dropdown" class="games-dropdown">
                        <button class="game-option" data-game="cuatroEnRaya">🎮 Cuatro en Raya</button>
                        <button class="game-option" data-game="dosVerdades">🤥 Dos Verdades y Una Mentira</button>
                    </div>
                </div>
                <input type="text" id="message-input" placeholder="Selecciona un chat para empezar" disabled>
                <button id="send-btn" onclick="sendMessage()" disabled>Enviar</button>
            </div>
        </div>
    </div>

    <!-- BOTÓN CIRCULAR DE PERFIL -->
    <div id="profileBtn" class="chat-open-button profile-button" onclick="toggleAuthMenu()" title="Cuenta">
        <svg id="profileSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="white">
            <path d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2.4c-3.6 0-10.8 1.8-10.8 5.4V22h21.6v-2.2c0-3.6-7.2-5.4-10.8-5.4z"/>
        </svg>
    </div>

    <!-- SCRIPTS DE FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script src="app.js"></script>
    <script src="listausuarios.js"></script>
    <script src="cuatroEnRayaScript.js"></script>
    <script src="dosVerdades.js"></script>
    <script src="gamesMenu.js"></script>
    <script src="easterEggs.js"></script>
</body>
</html>
